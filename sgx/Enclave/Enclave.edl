/* Enclave.edl - Top EDL file. */

enclave {

    trusted {
    											  

    public void ecall_Sgx_Set_Hidden_States([user_check]float* hidden_states, int B, int M, int N, [user_check]int* ret_id);

    public void ecall_Sgx_Copy_Hidden_States(int src_id, [user_check]int* ret_id);

    public void ecall_Sgx_Set_Layer_Norm_Param([user_check]float* gamma, [user_check]float* beta, int N, float eps, [user_check]int* ret_id);

    public void ecall_Sgx_Layer_Norm_Q(int src_id, int layer_norm_param_id, [user_check]int* ret_id);

    public void ecall_Sgx_Set_Linear_Param_WS8BS8([user_check]char* weight, [user_check]char* bias, int M, int N,
                                  float alpha, float beta, [user_check]int* ret_id);
    public void ecall_Sgx_Set_Linear_Param_WS8BFP32([user_check]char* weight, [user_check]float* bias, int M, int N,
                                    float alpha, [user_check]int* ret_id);

    /*void*/ public void ecall_Sgx_Get_Tensor_Dim_Int32(int src_id, [user_check]int* dim);
    /*void*/ public void ecall_Sgx_Get_Tensor_Int32(int src_id, [user_check]int* out);
    public void ecall_Sgx_Set_Tensor_Int32([user_check]int* data, int B, int M, int N, [user_check]int* ret_id);
    
    public void ecall_Sgx_Get_Encrypted_Tensor_Opr1_Int32(int src_id, int linear_param_id, [user_check]int* out);
    public void ecall_Sgx_Generate_Decryption_Key_Opr1_Int32(int blind_factor_id, int linear_param_id, [user_check]int *ret_id);
    public void ecall_Sgx_Set_Decrypted_Tensor_Opr1_Int32([user_check]int* data, int B, int M, int N,
                                          int linear_param_id, [user_check]int* ret_id);

    // This will return unblind factor id to unblind factor
    public void ecall_Sgx_Get_Encrypted_Tensor_Opr2_Int32(int src_id1, int src_id2, [user_check]int* out1,
                                          [user_check]int* out2, [user_check]int* blind_factor_ids);
    public void ecall_Sgx_Generate_Decryption_Key_Opr2_Int32(int src_id1, int src_id2, int blind_factor_u_id, int blind_factor_v_id, [user_check]int* ret_id);
    public void ecall_Sgx_Set_Decrypted_Tensor_Opr2_Int32([user_check]int* data, int B, int M, int N,
                                          int decryption_key_id, [user_check]int* ret_id);

    /*void*/ public void ecall_Sgx_Get_Tensor_Dim_Int8(int src_id, [user_check]int* dim);
    /*void*/ public void ecall_Sgx_Get_Tensor_Int8(int src_id, [user_check]char* out);
    public void ecall_Sgx_Set_Tensor_Int8([user_check]char* data, int B, int M, int N, [user_check]int* ret_id);

    /*void*/ public void ecall_Sgx_Get_Tensor_Dim_Float(int src_id, [user_check]int* dim);
    /*void*/ public void ecall_Sgx_Get_Tensor_Float(int src_id, [user_check]float* out);
    public void ecall_Sgx_Set_Tensor_Float([user_check]float* data, int B, int M, int N, [user_check]int* ret_id);

    public void ecall_Sgx_Compute_Epilogue_WS8BS8(int src_id, int linear_param_id, [user_check]int* ret_id);
    public void ecall_Sgx_Compute_Epilogue_WS8BFP32(int src_id, int linear_param_id, [user_check]int* ret_id);
    public void ecall_Sgx_Compute_Epilogue_BMM(int src_id, int bmm_param_id, [user_check]int* ret_id);

    public void ecall_Sgx_ReLU(int src_id, [user_check]int* ret_id);
    public void ecall_Sgx_Softmax(int src_id, [user_check]int* ret_id);
    public void ecall_Sgx_Quantize_Post_Softmax(int src_id, [user_check]int* ret_id);

    public void ecall_Sgx_Cast_From_Float_To_Int8(int src_id, [user_check]int* ret_id);
    public void ecall_Sgx_Cast_From_Float_To_Int32(int src_id, [user_check]int* ret_id);
    public void ecall_Sgx_Cast_From_Int8_To_Int32(int src_id, [user_check]int* ret_id);

    public void ecall_Sgx_Set_Bmm_Param(float alpha, [user_check]int* ret_id);

    public void ecall_Sgx_Residual_Add(int residual, int hidden_states, [user_check]int* ret_id);

        
    };

    /*
     * ocall_print_string - invokes OCALL to display string buffer inside the enclave.
     *  [in]: copy the string buffer to App outside.
     *  [string]: specifies 'str' is a NULL terminated buffer.
     */
    untrusted {
        void ocall_print_string([in, string] const char *str);
        void ocall_start_clock();
        double ocall_get_time();
        void ocall_end_clock([in, string] const char *str);
    };
};
